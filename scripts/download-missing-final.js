/**
 * SCRIPT FINAL PARA BAIXAR IMAGENS FALTANDO
 * Inclui todas as 469 imagens que estÃ£o faltando ou corrompidas
 * 
 * INSTRUÃ‡Ã•ES:
 * 1. Abra https://ragnatales.com.br/db/items no navegador
 * 2. Abra o DevTools (F12) â†’ Console
 * 3. Cole este script e pressione Enter
 * 4. As imagens serÃ£o baixadas em um ZIP
 * 5. Extraia para: public/images/ragnatales/
 */

(async function() {
  const MISSING_IDS = [
    "24940","510032","24954","700032","18152","18149","1865","24951","630012","550026",
    "24946","28762","24944","540021","32301","640019","24952","640033","610022","580017",
    "24949","16066","600013","24989","530010","24987","550088","540022","24945","28629",
    "24938","500025","24955","820002","820000","560019","24947","24996","2000007","28767",
    "24950","610020","610015","24907","13412","13413","24942","530013","32006","13167",
    "540013","540019","24943","1846","520008","24941","520003","28242","28240","28241",
    "28243","13146","28727","500026","24939","13143","18102","32357","24911","13337",
    "650009","24953","650004","28626","21050","13169","13168","24948","570017","5794",
    "460005","31312","24975","400054","17403","31370","490058","32205","28508","32257",
    "32238","32258","32259","28509","2954","17511","15386","15348","20314","20654",
    "17454","17542","17463","17581","20043","20251","31315","20065","20023","20378",
    "20348","20336","20215","15400","35042","35041","20594","31163","31132","20610",
    "31682","31155","20463","20593","20102","20418","31165","31784","31127","31215",
    "31172","22190","22228","19268","470060","22134","22209","32239","20697","17512",
    "20365","20370","20364","20367","20368","20366","20369","40118","20068","20334",
    "20012","20371","20013","20315","20021","20399","20391","20398","20393","20394",
    "20390","20395","20396","20392","20380","20352","20044","20351","40120","20847",
    "17569","20142","17654","19436","2546","19428","31240","31244","31239","31242",
    "31241","31243","31321","31159","20120","20106","31608","31313","17515","31424",
    "31634","31139","20166","20698","31217","20653","31640","31109","20592","31154",
    "20686","20576","20444","20194","33065","31650","31948","20249","20147","32203",
    "50745","50746","50747","50748","31738","31442","20345","20006","20308","20002",
    "490077","490078","17546","17547","17548","17549","31156","20581","20579","20580",
    "20404","20403","20405","31158","20107","33025","20684","31051","15283","35063",
    "17509","17502","32265","20220","20347","40121","35046","31190","20157","20465",
    "19366","31181","31282","20696","19312","24969","28955","28951","17593","31750",
    "20061","28956","17491","20238","5460","31131","31382","20340","31283","17510",
    "31302","20063","20205","20001","490243","24977","31357","20333","20346","20199",
    "20590","20004","5821","20595","31426","20133","22192","17470","2707","20621",
    "5321","17592","20160","20011","33018","31316","31371","5366","5844","28531",
    "40068","20611","19210","20372","2565","20947","20344","17591","20274","20038",
    "20326","31334","20689","20228","28565","31333","5054","50725","50726","50727",
    "50728","17535","35035","17544","17574","17562","20284","20933","20934","31329",
    "5788","31320","20257","20206","31356","20923","31305","31187","31606","31325",
    "20201","33074","20411","20185","20232","20384","22196","22197","17558","20092",
    "31153","31443","31117","40093","31427","31423","20202","31826","17460","5079",
    "20256","50665","50666","50667","50668","20122","28521","20260","31802","31317",
    "31336","20286","31169","24976","400453","31768","31160","31383","17504","5547",
    "20641","17699","5603","5604","5605","15368","2441","17594","20838","480023",
    "20275","20026","28922","50533","50534","50535","50536","20104","17586","24978",
    "28560","31855","40009","20450","20572","20573","20574","20409","20031","20295",
    "20639","20637","17570","20245","20243","20244","15254","15387","15420","15352",
    "20948","5301","31164","17540","17538","35049","305022","305006","305020","305004",
    "305010","305003","305007","305009","305011","305005","305012","305021","305017",
    "305024","305015","27353","305013","305018","27260","4256","4085","4492","305023",
    "4143","4071","27255","300301","305008","300345","300099","305002","305019","305016",
    "305014","305001","17107","17101","17100","311972","311970","311973","311975","311974"
  ];

  console.log('ğŸ–¼ï¸ Baixando', MISSING_IDS.length, 'imagens...');
  console.log('Isso pode demorar alguns minutos...\n');

  // Carregar JSZip
  const script = document.createElement('script');
  script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
  document.head.appendChild(script);
  
  await new Promise(r => setTimeout(r, 2000));
  
  const zip = new JSZip();
  let success = 0;
  let failed = 0;
  const failedIds = [];
  
  for (let i = 0; i < MISSING_IDS.length; i++) {
    const id = MISSING_IDS[i];
    try {
      const url = `https://api.ragnatales.com.br/database/item/icon?nameid=${id}`;
      const response = await fetch(url);
      
      if (response.ok) {
        const blob = await response.blob();
        // Verificar se Ã© uma imagem vÃ¡lida (mais de 100 bytes)
        if (blob.size > 100) {
          zip.file(`${id}.png`, blob);
          success++;
        } else {
          failedIds.push(id);
          failed++;
        }
      } else {
        failedIds.push(id);
        failed++;
      }
      
      if ((i + 1) % 50 === 0 || i === MISSING_IDS.length - 1) {
        console.log(`ğŸ“Š Progresso: ${i + 1}/${MISSING_IDS.length} | âœ… ${success} ok | âŒ ${failed} falhas`);
      }
      
      await new Promise(r => setTimeout(r, 80));
    } catch (e) {
      failedIds.push(id);
      failed++;
    }
  }
  
  console.log('\n' + '='.repeat(50));
  console.log(`âœ… ConcluÃ­do! ${success} imagens baixadas`);
  if (failed > 0) {
    console.log(`âŒ ${failed} imagens nÃ£o encontradas (podem nÃ£o existir no servidor)`);
  }
  console.log('ğŸ“¦ Gerando ZIP...');
  
  const content = await zip.generateAsync({ type: 'blob' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(content);
  a.download = 'ragnatales-images-final.zip';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  
  console.log('\nâœ… Download iniciado!');
  console.log('ğŸ“ Extraia para: F:\\Hela\\public\\images\\ragnatales\\');
})();

